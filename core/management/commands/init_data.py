from django.core.management.base import BaseCommand
from core.models import School, EditablePage
from django.contrib.auth import get_user_model

User = get_user_model()

class Command(BaseCommand):
    help = 'Инициализация базовых данных'

    def handle(self, *args, **options):
        # Создаем школы
        schools_data = [
            {'name': 'Школа №1 им. А.С. Пушкина', 'address': 'г. Бишкек, ул. Ленина, 1'},
            {'name': 'Школа №2 им. М.В. Ломоносова', 'address': 'г. Бишкек, ул. Советская, 15'},
            {'name': 'Школа №3 им. Ч. Айтматова', 'address': 'г. Бишкек, ул. Московская, 42'},
            {'name': 'Гимназия №4', 'address': 'г. Бишкек, ул. Киевская, 8'},
            {'name': 'Лицей №5', 'address': 'г. Бишкек, ул. Токтогула, 25'},
        ]
        
        for school_data in schools_data:
            school, created = School.objects.get_or_create(
                name=school_data['name'],
                defaults={'address': school_data['address']}
            )
            if created:
                self.stdout.write(
                    self.style.SUCCESS(f'Создана школа: {school.name}')
                )
            else:
                self.stdout.write(
                    self.style.WARNING(f'Школа уже существует: {school.name}')
                )

        # Создаем дефолтные страницы для русского языка
        pages_data = [
            {
                'page': 'about',
                'title': 'О проекте',
                'content': '''<p>Аноним Мектеп — это платформа, созданная для поддержки школьников, учителей и родителей. Здесь вы можете получить консультацию, поделиться проблемой или узнать полезную информацию, сохраняя анонимность.</p>
                
                <h4>Наша миссия</h4>
                <p>Создать безопасное пространство, где каждый может получить помощь и поддержку, не боясь осуждения или последствий.</p>
                
                <h4>Принципы работы</h4>
                <ul>
                    <li><strong>Анонимность</strong> — мы не сохраняем данные, которые могут вас идентифицировать</li>
                    <li><strong>Конфиденциальность</strong> — ваши сообщения видят только уполномоченные сотрудники</li>
                    <li><strong>Безопасность</strong> — все данные защищены современными методами шифрования</li>
                </ul>'''
            },
            {
                'page': 'faq',
                'title': 'Часто задаваемые вопросы',
                'content': '''<h4>Как работает анонимность?</h4>
                <p>Ваши сообщения не содержат личных данных и не отслеживаются. Мы не сохраняем IP-адреса или другую информацию, которая может вас идентифицировать.</p>
                
                <h4>Кто может воспользоваться сервисом?</h4>
                <p>Любой школьник, учитель или родитель может отправить сообщение через нашу платформу.</p>
                
                <h4>Как получить ответ?</h4>
                <p>Ответ поступит на указанный вами способ связи или будет опубликован на сайте в общем виде.</p>
                
                <h4>Кто видит мои сообщения?</h4>
                <p>Сообщения видят только уполномоченные сотрудники школы и районного отдела образования.</p>
                
                <h4>Можно ли отправить сообщение анонимно?</h4>
                <p>Да, все сообщения отправляются анонимно. Вы можете не указывать контактную информацию.</p>'''
            },
            {
                'page': 'contacts',
                'title': 'Полезные контакты',
                'content': '''<h4>Экстренные службы</h4>
                <ul>
                    <li><strong>Экстренная помощь:</strong> <a href="tel:112">112</a></li>
                    <li><strong>Полиция:</strong> <a href="tel:102">102</a></li>
                    <li><strong>Скорая помощь:</strong> <a href="tel:103">103</a></li>
                    <li><strong>Пожарная служба:</strong> <a href="tel:101">101</a></li>
                </ul>
                
                <h4>Психологическая помощь</h4>
                <ul>
                    <li><strong>Телефон доверия:</strong> <a href="tel:150">150</a></li>
                    <li><strong>Психологическая помощь:</strong> <a href="tel:142">142</a></li>
                </ul>
                
                <h4>Образовательные организации</h4>
                <ul>
                    <li><strong>Министерство образования:</strong> <a href="https://edu.gov.kg/">edu.gov.kg</a></li>
                    <li><strong>Городской отдел образования:</strong> <a href="tel:+996312123456">+996 (312) 12-34-56</a></li>
                </ul>'''
            },
            {
                'page': 'what_to_do',
                'title': 'Что делать, если...',
                'content': '''<h4>Если вы столкнулись с буллингом</h4>
                <ul>
                    <li>Обратитесь к школьному психологу</li>
                    <li>Сообщите классному руководителю</li>
                    <li>Напишите нам анонимно через форму на сайте</li>
                    <li>Расскажите родителям о ситуации</li>
                </ul>
                
                <h4>Если заметили нарушение</h4>
                <ul>
                    <li>Сообщите администрации школы</li>
                    <li>Используйте форму на нашем сайте</li>
                    <li>Обратитесь в районный отдел образования</li>
                </ul>
                
                <h4>Если нужна срочная помощь</h4>
                <ul>
                    <li>Позвоните на горячую линию: <a href="tel:150">150</a></li>
                    <li>Обратитесь в экстренные службы: <a href="tel:112">112</a></li>
                </ul>
                
                <h4>Если вас вымогают деньги</h4>
                <ul>
                    <li>Немедленно сообщите родителям</li>
                    <li>Обратитесь в полицию: <a href="tel:102">102</a></li>
                    <li>Сохраните все доказательства</li>
                </ul>'''
            }
        ]
        
        for page_data in pages_data:
            page, created = EditablePage.objects.get_or_create(
                page=page_data['page'],
                language='ru',
                defaults={
                    'title': page_data['title'],
                    'content': page_data['content']
                }
            )
            if created:
                self.stdout.write(
                    self.style.SUCCESS(f'Создана страница: {page.title}')
                )
            else:
                self.stdout.write(
                    self.style.WARNING(f'Страница уже существует: {page.title}')
                )

        self.stdout.write(
            self.style.SUCCESS('Инициализация данных завершена!')
        )
