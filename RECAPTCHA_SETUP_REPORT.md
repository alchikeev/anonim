# üîí –û—Ç—á–µ—Ç –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ reCAPTCHA

## üìã **–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

### **1. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ –¥–ª—è reCAPTCHA v3:**
- ‚úÖ **–®–∞–±–ª–æ–Ω** `send_message_step2.html` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è v3
- ‚úÖ **Views** `core/views.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è v3
- ‚úÖ **JavaScript** –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è –Ω–µ–≤–∏–¥–∏–º–æ–π reCAPTCHA v3

### **2. –°–æ–∑–¥–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ **`setup_recaptcha`** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª—é—á–µ–π –≤ .env —Ñ–∞–π–ª–∞—Ö
- ‚úÖ **`test_recaptcha`** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ **`demo_recaptcha`** - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏

### **3. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏:**
- ‚úÖ **Dev —Å—Ä–µ–¥–∞** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏ Google
- ‚úÖ **Prod —Å—Ä–µ–¥–∞** - –≥–æ—Ç–æ–≤–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏

## üõ†Ô∏è **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**

### **1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ reCAPTCHA:**
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
python manage.py setup_recaptcha

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
python manage.py setup_recaptcha --env dev --public-key YOUR_KEY --private-key YOUR_KEY

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
python manage.py setup_recaptcha --env prod --public-key YOUR_KEY --private-key YOUR_KEY

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –æ–±–µ–∏—Ö —Å—Ä–µ–¥
python manage.py setup_recaptcha --public-key YOUR_KEY --private-key YOUR_KEY
```

### **2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
python manage.py test_recaptcha

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏
python manage.py demo_recaptcha
```

## üìÅ **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

### **`core/templates/core/send_message_step2.html`:**
```html
<!-- reCAPTCHA v3 -->
<div class="mb-4">
    <input type="hidden" name="recaptcha_token" id="recaptcha_token">
    {% if form.non_field_errors %}
        <div class="text-danger mt-2">{{ form.non_field_errors }}</div>
    {% endif %}
</div>

<script src="https://www.google.com/recaptcha/api.js?render={{ recaptcha_public_key }}"></script>
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è reCAPTCHA v3
grecaptcha.ready(function() {
    grecaptcha.execute('{{ recaptcha_public_key }}', {action: 'submit'}).then(function(token) {
        document.getElementById('recaptcha_token').value = token;
    });
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
document.querySelector('form').addEventListener('submit', function(e) {
    e.preventDefault();
    grecaptcha.ready(function() {
        grecaptcha.execute('{{ recaptcha_public_key }}', {action: 'submit'}).then(function(token) {
            document.getElementById('recaptcha_token').value = token;
            e.target.submit();
        });
    });
});
</script>
```

### **`core/views.py`:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ reCAPTCHA v3
recaptcha_token = request.POST.get('recaptcha_token')
if not verify_recaptcha(recaptcha_token, request.META.get('REMOTE_ADDR')):
    form.add_error(None, '–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.')
```

## üîç **–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

### **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (.env.dev):**
```env
RECAPTCHA_PUBLIC_KEY=6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI
RECAPTCHA_PRIVATE_KEY=6LeIxAcTAAAAAGG-vFI1TnRWxMZNFuojJ4WifJWe
```

### **–ü—Ä–æ–¥–∞–∫—à–µ–Ω (.env.prod):**
```env
# –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
RECAPTCHA_PUBLIC_KEY=
RECAPTCHA_PRIVATE_KEY=
```

## üß™ **–¢–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ Google:**

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (localhost/127.0.0.1):**
- **–ü—É–±–ª–∏—á–Ω—ã–π:** `6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI`
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π:** `6LeIxAcTAAAAAGG-vFI1TnRWxMZNFuojJ4WifJWe`

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –≠—Ç–∏ –∫–ª—é—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ localhost –∏ 127.0.0.1!

## üöÄ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**

### **1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://www.google.com/recaptcha/admin
2. –ù–∞–∂–º–∏—Ç–µ "+" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Label:** –ê–Ω–æ–Ω–∏–º –ú–µ–∫—Ç–µ–ø
   - **reCAPTCHA type:** reCAPTCHA v3
   - **Domains:** anonim-m.online, www.anonim-m.online
4. –ü—Ä–∏–º–∏—Ç–µ —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
5. –ù–∞–∂–º–∏—Ç–µ "Submit"
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Site Key –∏ Secret Key

### **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
```bash
python manage.py setup_recaptcha --env prod --public-key YOUR_REAL_PUBLIC_KEY --private-key YOUR_REAL_PRIVATE_KEY
```

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
export DJANGO_ENV=prod
python manage.py test_recaptcha
```

## ‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ reCAPTCHA v3:**

### **1. –ù–µ–≤–∏–¥–∏–º–∞—è –∑–∞—â–∏—Ç–∞:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç –∫–∞–ø—á—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- ‚úÖ –õ—É—á—à–∏–π UX

### **2. –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è:**
- ‚úÖ –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ (score 0.0-1.0)
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞
- ‚úÖ –ú–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π

### **3. –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚úÖ –ú–∏–Ω–∏–º—É–º –∫–æ–¥–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å AJAX

## üîç **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

### **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**
```
üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π:
  ‚úÖ RECAPTCHA_PUBLIC_KEY: 6LeIxAcTAA...
  ‚úÖ RECAPTCHA_PRIVATE_KEY: 6LeIxAcTAA...

üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google:
  ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google reCAPTCHA: OK
```

### **–ü—Ä–æ–¥–∞–∫—à–µ–Ω:**
```
üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π:
  ‚ö†Ô∏è  RECAPTCHA_PUBLIC_KEY: –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
  ‚ö†Ô∏è  RECAPTCHA_PRIVATE_KEY: –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
```

## üéØ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

### **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
- ‚úÖ **–ì–æ—Ç–æ–≤–æ** - —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ **–ì–æ—Ç–æ–≤–æ** - —Ñ–æ—Ä–º—ã –∑–∞—â–∏—â–µ–Ω—ã
- ‚úÖ **–ì–æ—Ç–æ–≤–æ** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
1. **–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏** –Ω–∞ Google reCAPTCHA
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–ª—é—á–∏** –∫–æ–º–∞–Ω–¥–æ–π `setup_recaptcha`
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –∫–æ–º–∞–Ω–¥–æ–π `test_recaptcha`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É** –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ

## üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

### **–ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ:**
- ‚úÖ **–§–æ—Ä–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π** - –∑–∞—â–∏—â–µ–Ω—ã reCAPTCHA v3
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞** - –ø–æ –æ—Ü–µ–Ω–∫–µ —Ä–∏—Å–∫–∞

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score:** 0.5 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `recaptcha_utils.py`)
- ‚úÖ **–¢–∞–π–º–∞—É—Ç:** 10 —Å–µ–∫—É–Ω–¥
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ IP:** –≤–∫–ª—é—á–µ–Ω–∞

---

**üîí reCAPTCHA –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ‚úÖ –ì–æ—Ç–æ–≤–æ  
**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:** ‚è≥ –¢—Ä–µ–±—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏
